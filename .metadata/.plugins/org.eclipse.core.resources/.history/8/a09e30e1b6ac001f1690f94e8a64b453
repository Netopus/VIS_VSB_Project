package cz.vsb.tuo.kel0060;

import java.sql.Connection;
import java.sql.SQLException;
import java.util.List;
import org.springframework.stereotype.Service;

import Entities.Manga;
import cz.vsb.tuo.kel0060.classes.MangaServiceInterface;
import cz.vsb.tuo.kel0060.repository.MangaRepository;



/**
 * Real Implementation of MangaService:
 * Simulates fetching manga details from a real database or API.
 */

@Service
public class MangaService implements MangaServiceInterface {
    private final MangaRepository mangaRepository;
    private final AccessLogRepository accessLogRepository;

    public MangaService(MangaRepository mangaRepository, AccessLogRepository accessLogRepository) {
        this.mangaRepository = mangaRepository;
        this.accessLogRepository = accessLogRepository;
    }

    public void logAccess(int mangaId, String username, Connection conn) throws SQLException {
        mangaRepository.getMangaById(mangaId); // Ensure the manga exists
        accessLogRepository.logAccess(conn, mangaId, username); // Log the access
    }

    public int getAccessCount(int mangaId, Connection conn) throws SQLException {
        return accessLogRepository.getAccessCountByMangaId(conn, mangaId);
    }

    public List<AccessLog> getRecentAccessLogs(int mangaId, Connection conn) throws SQLException {
        return accessLogRepository.getRecentAccessLogsByMangaId(conn, mangaId);
    }
    
    @Override
    public Manga getMangaDetails(String title) {
        // Simulate a database or API call
        return new Manga(0, 0, title, "AuthorName", 0, null);
    }
}
